
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>iOS 中的断点续传 | Summerrose’s Blog</title>

	<meta name="author" content="ghren"> 
	
	<meta name="description" content="关键点 实现断点续传的关键是自定义http request的头部的range域属性 Range头域可以请求实体的一个或者多个子范围。例如， 表示头500个字节：bytes=0-499 表示第二个500字节：bytes=500-999 表示最后500个字节：bytes=-500 &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Summerrose’s Blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	
</head>



<body>
	<header id="header">
<div class="inner">
  <ul class="navigation">
    <li><a href="/"><h1>Summerrose’s Blog</h1></a></li>
    <li><a href="/" class="is-selected">Blog</a></li>
    <li><a href="http://github.com/" target="blank">Github</a></li>
  </ul>
</div></header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">iOS 中的断点续传</h2>
	<div class="meta">
		<div class="date">








  



<time datetime="2014-07-16T17:25:31+08:00" pubdate data-updated="true">Jul 16th, 2014</time></div>
	</div>
	<div class="entry-content"><p><img src="/images/201407161730.png" alt="" /></p>

<h4 id="section">关键点</h4>

<p>实现断点续传的关键是自定义http request的头部的range域属性</p>

<p>Range头域可以请求实体的一个或者多个子范围。例如，</p>

<p>表示头500个字节：bytes=0-499</p>

<p>表示第二个500字节：bytes=500-999</p>

<p>表示最后500个字节：bytes=-500</p>

<p>表示500字节以后的范围：bytes=500-</p>

<p>第一个和最后一个字节：bytes=0-0,-1</p>

<p>同时指定几个范围：bytes=500-600,601-999</p>

<h4 id="section-1">基本思想</h4>

<p>1、获取已下载文件的大小，用来确定下载的文件从什么地方开始续传(即获取range属性的范围);</p>

<p>2、设置http request请求头文件，要包含range属性;</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="bp">NSMutableURLRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableURLRequest</span> <span class="nl">requestWithURL</span><span class="p">:</span><span class="n">url</span> <span class="nl">cachePolicy</span><span class="p">:</span><span class="n">NSURLRequestUseProtocolCachePolicy</span> <span class="nl">timeoutInterval</span><span class="p">:</span><span class="mf">5.0f</span><span class="p">];</span>
</span><span class="line">   <span class="c1">// 设置请求头文件</span>
</span><span class="line"><span class="bp">NSString</span> <span class="o">*</span><span class="n">rangeValue</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;bytes=%llu-&quot;</span><span class="p">,</span> <span class="n">from</span><span class="p">];</span>
</span><span class="line"><span class="p">[</span><span class="n">request</span> <span class="nl">addValue</span><span class="p">:</span><span class="n">rangeValue</span> <span class="nl">forHTTPHeaderField</span><span class="p">:</span><span class="s">@&quot;Range&quot;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>

<p>3、 发起http下载请求;</p>

<h4 id="section-2">具体实现</h4>

<p>可以用iOS自带的NSURLConnection，也可以使用第三方如AFNetWorking实现。</p>

<p><a href="http://www.cnblogs.com/liufeng24/p/3555303.html">NSURLConnection实现方法</a>；</p>

<p><a href="http://blog.csdn.net/zhaoxy_thu/article/details/21383515">AFNetworking实现方法</a>;</p>

<p><a href="https://github.com/thibaultCha/TCBlobDownload">TCBlobDownload</a>;</p>

<h4 id="section-3">参考资料</h4>

<p>1.<a href="http://blog.csdn.net/sirchenhua/article/details/7286312">ios 实现断点续传 一 nsurlconnection</a>;</p>

<p>2.<a href="http://longminxiang.blog.163.com/blog/static/5933298520137933235997/">IOS Http断点续传浅析</a>;</p>

<p>3.<a href="http://www.cnblogs.com/liufeng24/p/3555303.html">iOS开发网络编程之断点续传-NSURLConnection</a>;</p>

<p>4.<a href="http://blog.csdn.net/zhaoxy_thu/article/details/21383515">AFNetworking实现程序重新启动时的断点续传</a>；</p>

</div>


<div class="sharing">
  
  <div class="sns-tw">
    <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js  ';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  </div>
  
  
  
</div>
</article>
</div>
	<footer id="footer" class="inner"><div class="aboutme">
<hr>
  <div class="profile">
    <a href="http://twitter.com/"><img class="icon" src=""></a>

    <h3>ghren</h3>
    <p><a href="http://twitter.com/">@</a></p>

    <div class="codes">
      <h4>Codes</h4>
      <div class="github"><a href="https://github.com/">github.com/</a></div>
    </div>
  </div>

  <div class="float_clear"></div>

</div>
Copyright &copy; 2016
 ghren 
<br>
Powered by Octopress.



</footer>
	

</body>
</html>
